public class Карта
{
    private int ширинаКарти;
    private int висотаКарти;
    private Клітинка[,] клітинки;

    public Карта(int ширинаКарти, int висотаКарти)
    {
        this.ширинаКарти = ширинаКарти;
        this.висотаКарти = висотаКарти;
        клітинки = new Клітинка[ширинаКарти, висотаКарти];
    }

    public void Ініціалізація()
    {
        for (int x = 0; x < ширинаКарти; x++)
        {
            for (int y = 0; y < висотаКарти; y++)
            {
                клітинки[x, y] = new Клітинка();
            }
        }

        // Ініціалізація трави, зайців і лисиць
        for (int i = 0; i < 20; i++)
        {
            int x = ВипадковеЧисло(1, 10);
            int y = ВипадковеЧисло(1, 10);
            клітинки[x, y].Трава = new Трава();
        }

        for (int i = 0; i < 10; i++)
        {
            int x = ВипадковеЧисло(1, 10);
            int y = ВипадковеЧисло(1, 10);
            клітинки[x, y].Зайець = new Зайець();
        }

        for (int i = 0; i < 5; i++)
        {
            int x = ВипадковеЧисло(1, 10);
            int y = ВипадковеЧисло(1, 10);
            клітинки[x, y].Лисиця = new Лисиця();
        }
    }

    public void СимулюватиДень()
    {
        // Рост трави
        for (int x = 1; x < ширинаКарти - 1; x++)
        {
            for (int y = 1; y < висотаКарти - 1; y++)
            {
                if (клітинки[x, y].Трава != null)
                {
                    клітинки[x, y].Трава.Рост();
                }
                else if (ВипадковеЧисло(1, 10) == 1) // 10% шанс на рост нової трави
                {
                    клітинки[x, y].Трава = new Трава();
                }
            }
        }

        // Симуляція зайців
        for (int x = 1; x < ширинаКарти - 1; x++)
        {
            for (int y = 1; y < висотаКарти - 1; y++)
            {
                if (клітинки[x, y].Зайець != null)
                {
                    клітинки[x, y].Зайець.Їжа(клітинки, x, y);
                    клітинки[x, y].Зайець.Відтворення(клітинки, x, y);
                }
            }
        }

        // Симуляція волків
        for (int x = 1; x < ширинаКарти - 1; x++)
        {
            for (int y = 1; y < висотаКарти - 1; y++)
            {
                if (клітинки[x, y].Лисиця != null)
                {
                    клітинки[x, y].Лисиця.Охота(клітинки, x, y);
                    клітинки[x, y].Лисиця.Відтворення(клітинки, x, y);
                }
            }
        }

        // Видалення мертвих тварин та старої трави
        for (int x = 1; x < ширинаКарти - 1; x++)
        {
            for (int y = 1; y < висотаКарти - 1; y++)
            {
                if (клітинки[x, y].Зайець != null && !клітинки[x, y].Зайець.Жив)
                {
                    Console.WriteLine($"Зайець у ({x}, {y}) загинув.");
                    клітинки[x, y].Зайець = null;
                }

                if (клітинки[x, y].Лисиця != null && !клітинки[x, y].Лисиця.Жив)
                {
                    Console.WriteLine($"Лисиця у ({x}, {y}) загинув.");
                    клітинки[x, y].Лисиця = null;
                }

                if (клітинки[x, y].Трава != null && клітинки[x, y].Трава.Вік > 2)
                {
                    Console.WriteLine($"Трава у ({x}, {y}) з віком {клітинки[x, y].Трава.Вік} була видалена.");
                    клітинки[x, y].Трава = null;
                }
            }
        }
    }

    public void ВивестиКарту()
    {
        Console.WriteLine(new string('-', ширинаКарти * 2));
        for (int y = 1; y < висотаКарти - 1; y++)
        {
            Console.Write('|');
            for (int x = 1; x < ширинаКарти - 1; x++)
            {
                if (клітинки[x, y].Лисиця != null)
                {
                    Console.Write('Л');
                }
                else if (клітинки[x, y].Зайець != null)
                {
                    Console.Write('З');
                }
                else if (клітинки[x, y].Трава != null)
                {
                    Console.Write('Т');
                }
                else
                {
                    Console.Write('_');
                }
                Console.Write(' ');
            }
            Console.WriteLine("|");
        }
        Console.WriteLine(new string('-', ширинаКарти * 2));
    }

    public bool КінецьГри()
    {
        bool єЗайці = false;
        bool єЛисиця = false;

        for (int x = 1; x < ширинаКарти - 1; x++)
        {
            for (int y = 1; y < висотаКарти - 1; y++)
            {
                if (клітинки[x, y].Зайець != null)
                {
                    єЗайці = true;
                }

                if (клітинки[x, y].Лисиця != null)
                {
                    єЛисиця = true;
                }
            }
        }

        return !(єЗайці && єЛисиця);
    }

    private int ВипадковеЧисло(int мін, int макс)
    {
        Random випадкова = new Random();
        return випадкова.Next(мін, макс + 1);
    }
}